<!DOCTYPE html>
<html lang=en>

<body>

    <head>
        <meta charset="utf-8">
        <meta name="description" content="a description">
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <title>PRODO</title>
        <!-- title bar icon -->
        <link rel="icon" href="../logo_icon.png" type="image/icon type">

        <!-- Font Awesome Icon-->
        <script src='https://kit.fontawesome.com/a076d05399.js' crossorigin='anonymous'></script>

        <!-- BootStrap -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
            integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

        <link rel="stylesheet" href="notes.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Code">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

        <!-- auth -->
        <script type="module">
            // Import functions
            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js";
            import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-auth.js";

            // Firebase configuration
            const firebaseConfig = {
                apiKey: "AIzaSyD6cBjkEmTTc7uVNC3sD0RlFgF_9fAPY9g",
                authDomain: "student-web-desk.firebaseapp.com",
                databaseURL: "https://student-web-desk-default-rtdb.firebaseio.com",
                projectId: "student-web-desk",
                storageBucket: "student-web-desk.appspot.com",
                messagingSenderId: "97747219553",
                appId: "1:97747219553:web:fed6cae0333b3eedc02620",
                measurementId: "G-LT7LDF5MRT"
            };

            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const auth = getAuth();

            // listen for current user
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    // User is signed in
                    const uid = user.uid;
                    // ...
                    console.log(uid);

                    var loggedInUser = document.querySelector("#user_email");
                    loggedInUser = user.email;

                    // ...
                    console.log(loggedInUser);

                    $("#userInfoEmail").text(loggedInUser);
                    $("#userCard").show();
                    $("#logoutButton").show();
                } else {
                    // User is signed out
                    // ...
                    $("#alertInfoModal").modal('show');

                    // hide and redirect after 3 sec
                    setTimeout(function () {
                        $("#alertInfoModal").modal('hide');

                        window.location.href = '../index.html';
                    }, 3000);
                }
            });

            // logging out
            const logoutButton = document.querySelector("#logoutButton");
            logoutButton.addEventListener('click', (e) => {
                e.preventDefault();

                auth.signOut().then(() => {
                    console.log("user logged out");

                    // show alert
                    $("#alertInfoModal").modal('show');

                    // hide after 3 sec
                    setTimeout(function () {
                        $("#alertInfoModal").modal('hide');
                    }, 3000);

                });

            });

        </script>
    </head>

    <body>
        <div id="body_container">
            <div class="header">
                <a href="../New Tab/newtab.html">
                    <div class="logo_box">
                        <img src="../Images/logo_icon.png" id="logo">
                        <h1 id="web_app_name">PRODO</h1>
                    </div>

                </a>
                <div class="menu_bar">
                    <a href="../Dashboard/dashboard.html">
                        <h3 id="menu_dashboard">Dashboard</h3>
                    </a>
                    <h3 id="menu_calendar">Calendar</h3>
                    <a href="../ToDo/todo.html">
                        <h3 id="menu_todo">Kanban</h3>
                    </a>
                    <a href="../Pomodoro/Pomodoro.html">
                        <h3 id="menu_study">Pomodoro</h3>
                    </a>
                    <a href="../Widgets/widgets.html">
                        <h3 id="menu_widgets">Pricing</h3>
                    </a>
                    </a>
                    <a href="../Notes/notes.html">
                        <h3 id="menu_notes">Notes</h3>
                    </a>
                </div>

                <!-- user card -->
                <div id="userCard" class="card bg-light"
                    style="display: none; position: relative; right: 10%; top: 0px; text-align: center; padding: 5px; height: 40px;">
                    <div id="userIcon">
                        <i style="font-size: 24px; color: rgb(85,208,156);" class='fas fa-user-astronaut'></i>
                        <span style="font-size: 16px;" id="userInfoEmail"></span>
                    </div>

                </div>

                <!--logout button-->
                <div id="logoutButton" style="display: none; position: absolute; right: 4%; top: 20px;">
                    <button onclick="" class="btn btn-primary">Logout</button>
                </div>

            </div>

            <div id="myDIV" class="header">
                <h2 style="margin:5px">NOTES</h2>
                <input type="text" id="myInput" placeholder="Add your notes">
                <span onclick="newElement()" class="addBtn">Add</span>

            </div>



            <ul id="myUL">

            </ul>
            

            <!-- alert info modal -->
            <div class="modal fade" id="alertInfoModal" tabindex="-1" role="dialog"
            aria-labelledby="alertInfoModalTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="alertInfoModalTitle">Session ended</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">

                        <div class="alert alert-info" role="alert">
                            You have been logged out. Please login!
                            <small id="alt" class="form-text text-muted">You will be redirected in few seconds. <a
                                    href="../index.html">Click here</a> to get started now.</small>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        
        </div>

            <script>
                var myNodelist = document.getElementsByTagName("LI");
                var i;
                for (i = 0; i < myNodelist.length; i++) {
                    var span = document.createElement("SPAN");
                    var txt = document.createTextNode("\u00D7");
                    span.className = "close";
                    span.appendChild(txt);
                    myNodelist[i].appendChild(span);
                }

                var close = document.getElementsByClassName("close");
                var i;
                for (i = 0; i < close.length; i++) {
                    close[i].onclick = function () {
                        var div = this.parentElement;
                        div.style.display = "none";
                    }
                }

                var list = document.querySelector('ul');
                list.addEventListener('click', function (ev) {
                    if (ev.target.tagName === 'LI') {
                        ev.target.classList.toggle('checked');
                    }
                }, false);

                function newElement() {
                    var li = document.createElement("li");
                    var inputValue = document.getElementById("myInput").value;
                    var t = document.createTextNode(inputValue);
                    li.appendChild(t);
                    if (inputValue === '') {
                        alert("You must write something!");
                    } else {
                        document.getElementById("myUL").appendChild(li);
                    }
                    document.getElementById("myInput").value = "";

                    var span = document.createElement("SPAN");
                    var txt = document.createTextNode("\u00D7");
                    span.className = "close";
                    span.appendChild(txt);
                    li.appendChild(span);

                    for (i = 0; i < close.length; i++) {
                        close[i].onclick = function () {
                            var div = this.parentElement;
                            div.style.display = "none";
                        }
                    }
                }

            </script>

            <!-- BootStrap -->

            <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
                integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
                crossorigin="anonymous"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
                integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
                crossorigin="anonymous"></script>
            <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
                integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
                crossorigin="anonymous"></script>
    </body>

</html>